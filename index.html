<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic Questionnaire</title>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f8f9fa;
      color: #495057;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      min-height: 100vh;
    }

    h1 {
      text-align: center;
      color: #007bff;
      margin-top: 20px;
    }

    #questionsContainer {
      background-color: #ffffff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      width: 100%;
      box-sizing: border-box;
      border: 2px solid #007bff;
      margin-bottom: 20px;
      overflow-y: auto;
      max-height: 60vh;
    }

    div {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #007bff;
    }

    .options-container {
      display: flex;
      gap: 10px;
    }

    button {
      background-color: #007bff;
      color: #fff;
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      box-sizing: border-box;
    }

    button:hover {
      background-color: #0056b3;
    }

    button.selected {
      background-color: #28a745;
    }

    #generateButton {
      display: block;
      margin: 20px auto;
      font-size: 16px;
      padding: 10px 20px;
      width: fit-content;
    }

    .progress-bar-container {
      width: 100%;
      background-color: #e9ecef;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .progress-bar {
      width: 0;
      height: 20px;
      background-color: #007bff;
      border-radius: 8px;
      text-align: center;
      color: white;
      transition: width 0.3s;
      white-space: nowrap;
    }

    #presetContainer {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
    }

    #presetContainer label {
      margin-right: 10px;
    }

    #presetContainer select {
      padding: 5px;
      border-radius: 5px;
      border: 1px solid #007bff;
      margin-right: 10px;
    }

    #savePresetButton,
    #deletePresetButton {
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-right: 10px;
    }

    #savePresetButton:hover,
    #deletePresetButton:hover {
      background-color: #0056b3;
    }

    #notification {
      margin-top: 20px;
      padding: 10px;
      border-radius: 5px;
      display: none;
    }

    .summary-container {
      background-color: #ffffff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      width: 100%;
      box-sizing: border-box;
      border: 2px solid #007bff;
      margin-bottom: 20px;
    }

    .summary-container div {
      margin-bottom: 10px;
    }

    .summary-container label {
      display: inline-block;
      margin-right: 10px;
    }

    .summary-container button {
      padding: 5px 10px;
    }

    @media (max-width: 768px) {
      #questionsContainer {
        width: 90%;
      }
    }
  </style>
</head>
<body>

  <h1>Dynamic Questionnaire</h1>

  <div class="progress-bar-container">
    <div class="progress-bar" id="progressBar">0%</div>
  </div>

  <div id="questionsContainer"></div>

  <label for="numQuestions">Number of Questions:</label>
  <input type="number" id="numQuestions" min="1" value="1">
  <button id="generateButton" type="button" onclick="generateQuestions()">Generate Questions</button>

  <div id="presetContainer">
    <label for="presetSelect">Select Preset:</label>
    <select id="presetSelect" onchange="loadPreset()">
      <option value="default">Default</option>
    </select>
    <button id="savePresetButton" type="button" onclick="savePreset()">Save Preset</button>
    <button id="deletePresetButton" type="button" onclick="deletePreset()">Delete Preset</button>
  </div>

  <div id="notification"></div>

  <div id="summaryContainer" class="summary-container" style="display: none;"></div>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/html-inspector/0.8.2/html-inspector.js"></script>
  <script>
    function generateQuestions() {
      var numQuestions = document.getElementById("numQuestions").value;
      var questionDiv = document.getElementById("questionsContainer");
      questionDiv.innerHTML = "";
      resetProgressBar();

      for (var i = 1; i <= numQuestions; i++) {
        questionDiv.innerHTML += `
          <div>
            <label for="q${i}">Question ${i}: What is your choice?</label>
            <div class="options-container">
              <button type="button" onclick="chooseOption('أ', ${i}, ${numQuestions})" data-option="أ">أ</button>
              <button type="button" onclick="chooseOption('ب', ${i}, ${numQuestions})" data-option="ب">ب</button>
              <button type="button" onclick="chooseOption('ج', ${i}, ${numQuestions})" data-option="ج">ج</button>
              <button type="button" onclick="chooseOption('د', ${i}, ${numQuestions})" data-option="د">د</button>
            </div>
            <input type="hidden" id="q${i}" name="q${i}" value="">
          </div>
        `;
      }

      loadResponses();
    }

    function chooseOption(option, questionNumber, totalQuestions) {
      var selectedOption = option;
      var questionName = "q" + questionNumber;
      document.getElementById(questionName).value = selectedOption;

      // Toggle the 'selected' class for styling
      var buttons = document.querySelectorAll(`#questionsContainer > div:nth-child(${questionNumber}) .options-container button`);
      buttons.forEach(function(button) {
        button.classList.remove('selected');
      });

      var selectedButton = document.querySelector(`#questionsContainer > div:nth-child(${questionNumber}) .options-container button[data-option="${option}"]`);
      if (selectedButton) {
        selectedButton.classList.add('selected');
      }

      // Update the progress bar
      updateProgressBar(totalQuestions);

      // Save responses to local storage
      saveResponses();

      // Show summary if all questions are answered
      if (progressBarIsComplete(totalQuestions)) {
        showSummary(totalQuestions);
      }
    }

    function updateProgressBar(totalQuestions) {
      var answeredQuestions = 0;
      for (var i = 1; i <= totalQuestions; i++) {
        if (document.getElementById(`q${i}`).value !== "") {
          answeredQuestions++;
        }
      }
      var progress = (answeredQuestions / totalQuestions) * 100;
      var progressBar = document.getElementById("progressBar");
      progressBar.style.width = progress + "%";
      progressBar.textContent = Math.round(progress) + "%";
    }

    function resetProgressBar() {
      var progressBar = document.getElementById("progressBar");
      progressBar.style.width = "0%";
      progressBar.textContent = "0%";
    }

    function saveResponses() {
      var responses = {};
      var inputs = document.querySelectorAll('#questionsContainer input[type="hidden"]');
      inputs.forEach(function(input) {
        responses[input.id] = input.value;
      });
      var presetName = document.getElementById("presetSelect").value;
      localStorage.setItem(presetName, JSON.stringify(responses));
      showNotification(`Preset '${presetName}' saved successfully!`);
    }

    function loadResponses() {
      var presetName = document.getElementById("presetSelect").value;
      var responses = JSON.parse(localStorage.getItem(presetName));
      if (responses) {
        Object.keys(responses).forEach(function(key) {
          var value = responses[key];
          var input = document.getElementById(key);
          if (input) {
            input.value = value;
            var questionNumber = key.replace('q', '');
            var selectedButton = document.querySelector(`#questionsContainer > div:nth-child(${questionNumber}) .options-container button[data-option="${value}"]`);
            if (selectedButton) {
              selectedButton.classList.add('selected');
            }
          }
        });
        var totalQuestions = document.getElementById("numQuestions").value;
        updateProgressBar(totalQuestions);
      }
    }

    function savePreset() {
      var presetName = prompt("Enter a name for this preset:");
      if (presetName) {
        var presetSelect = document.getElementById("presetSelect");
        var option = document.createElement("option");
        option.value = presetName;
        option.text = presetName;
        presetSelect.add(option);
        presetSelect.value = presetName;
        saveResponses();
      }
    }

    function deletePreset() {
      var presetSelect = document.getElementById("presetSelect");
      var presetName = presetSelect.value;
      if (presetName !== "default") {
        localStorage.removeItem(presetName);
        presetSelect.remove(presetSelect.selectedIndex);
        presetSelect.value = "default";
        loadResponses();
        showNotification(`Preset '${presetName}' deleted successfully!`);
      } else {
        showNotification("Default preset cannot be deleted!", true);
      }
    }

    function loadPreset() {
      generateQuestions();
      loadResponses();
    }

    function progressBarIsComplete(totalQuestions) {
      var answeredQuestions = 0;
      for (var i = 1; i <= totalQuestions; i++) {
        if (document.getElementById(`q${i}`).value !== "") {
          answeredQuestions++;
        }
      }
      return answeredQuestions === totalQuestions;
    }

    function showSummary(totalQuestions) {
      var summaryContainer = document.getElementById("summaryContainer");
      summaryContainer.innerHTML = "<h2>Summary of Your Answers</h2>";
      summaryContainer.style.display = "block";

      for (var i = 1; i <= totalQuestions; i++) {
        var answer = document.getElementById(`q${i}`).value;
        summaryContainer.innerHTML += `
          <div>
            <label>Question ${i}: ${answer}</label>
            <button type="button" onclick="markAnswer(${i}, true)">Correct</button>
            <button type="button" onclick="markAnswer(${i}, false)">Incorrect</button>
          </div>
        `;
      }
    }

    function markAnswer(questionNumber, isCorrect) {
      var questionLabel = document.querySelector(`#summaryContainer div:nth-child(${questionNumber + 1}) label`);
      if (isCorrect) {
        questionLabel.style.color = "green";
      } else {
        questionLabel.style.color = "red";
      }
    }

    function showNotification(message, isError = false) {
      var notification = document.getElementById("notification");
      notification.textContent = message;
      notification.style.display = "block";
      notification.style.backgroundColor = isError ? "#f8d7da" : "#d4edda";
      notification.style.color = isError ? "#721c24" : "#155724";
      setTimeout(() => {
        notification.style.display = "none";
      }, 3000);
    }

    document.addEventListener("DOMContentLoaded", () => {
      // Initialize the default preset if not present
      if (!localStorage.getItem("default")) {
        localStorage.setItem("default", JSON.stringify({}));
      }
      // Load default preset
      loadPreset();
    });
  </script>

</body>
</html>
